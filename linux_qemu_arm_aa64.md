#   QEMU AArch64 System Emulation

`qemu-system-aarch64`
-   QEMU System Emulation for AArch64.

`-machine virt-7.0,secure=off,virtualization=off,iommu=none,gic-version=3`
-   QEMU `virt` machine, with some additional settings. Default is GICv2; secure, virt, iommu all off.
-   Add `dumpdtb=qemu_virt.dtb` to save the dtb which generated by QEMU for Linux Kernel.
    QEMU will exit after saving the dtb.
-   Check `QEMU Help - System Emulation - QEMU System Emulator Targets - virt generic virtual platform`
    for Machine Specific options.

`-smp 8 -cpu cortex-a53 -accel tcg -m 4G`
-   8 CPUs; CPU Type is Cortex-A53; Accelerator is TCG (the only option); Memory is 4GiB.
-   Check `QEMU Help - System Emulation - QEMU System Emulator Targets - virt generic virtual platform`
    for CPU supported.

`-kernel boot.knl -initrd boot.rfs -append "console=ttyAMA0 vt.global_cursor_default=0 root=/dev/vda1"`
-   Kernel to be loaded; initramfs to be loaded; kernel command line to be applied.
-   If display/graphic is set, `vt.global_cursor_default=0` could be used to disable GUI console.
-   If `-initrd` is applied, `root=*` in kernel command line will not take effect.

`-serial mon:stdio`
-   PL011 serial port is mapped to stdio, which name is `ttyAMA0` in Linux.

`-nographic` :OR: `-device virtio-gpu-pci`
-   Disable GUI with `nographic`; Enable GUI using `virtio-gpu-pci`.

`-nic user,model=virtio,tftp=.,hostfwd=tcp::5555-:22`
-   NIC, using host NAT, virtio-net driver; enable TFTP at current directory; forward host TCP 5555 to VM 22.

`-drive file=disk.img,format=raw,if=virtio`
-   HDD, using virtio-blk driver.


#   Linux Config Related

QEMU virt machine mainly uses PCI for peripheral expansion; only limited devices are memory mapped.

-   ARM Core Support:
```
CPU, e.g. Cortex-A53, etc.
GIC v2/v3.
```


-   Device Drivers:
```
Character devices
    Enable TTY
        Virtual terminal
            Enable character translations in console
            Support for console on virtual terminal
            Support for binding and unbinding console drivers
        Unix98 PTY support
        Legacy (BSD) PTY support
        Automatically load TTY Line Disciplines
    Serial drivers
        ARM AMBA PL011 serial port support
            Support for console on AMBA serial port
    Serial device bus
        Serial device TTY port controller
    Virtio console
    /dev/mem virtual device support
    /dev/port character device
    Initialize RNG using bootloader-supplied seed

GPIO Support
    /sys/class/gpio/... (sysfs interface)
    Character device (/dev/gpiochipN) support
    Support GPIO ABI Version 1
    Memory mapped GPIO drivers
        PrimeCell PL061 GPIO support

Real Time Clock
    Set system time from RTC on startup and re
    /sys/class/rtc/rtcN (sysfs)
    /proc/driver/rtc (procfs for rtcN)
    /dev/rtcN (character devices)
    ARM AMBA PL031 RTC

Clock Source drivers
    Enable ARM architected timer event stream generation by default

IOMMU Hardware Support
    Generic IOMMU Pagetable Support
        ARMv7/v8 Long Descriptor Format
        ARMv7/v8 Short Descriptor Format
    ARM Ltd. System MMU (SMMU) Support
    ARM Ltd. System MMU Version 3 (SMMUv3) Support
    Virtio IOMMU driver

PCI support
    PCI controller drivers
        Generic PCI host controller

Block devices
    Virtio block driver

Network device support
    Network core driver support
        Virtio network driver

Graphics support
    Direct Rendering Manager
    Enable legacy fbdev support for your modesetting driver
    Virtio GPU driver
    Frame Buffer Devices
        Support for frame buffer devices
            Enable Video Mode Handling Helpers
    Console display driver support
        Framebuffer Console support (Optional)

Virtio drivers
    PCI driver for virtio devices
    Virtio input driver
    Platform bus driver for memory mapped virtio devices
```
